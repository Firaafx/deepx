<!-- web/tracker.html -->
<!DOCTYPE html>
<html>
<head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap');
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Poppins', sans-serif; color: #e0e0e0; }
        #canvas-container { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; }
        /* --- TRACKER PANEL (LEFT) --- */
        #tracker-panel {
            position: absolute; top: 260px; left: 10px; width: 240px;
            background: linear-gradient(to bottom, rgba(20,20,30,0.95), rgba(5,5,10,0.95)); border: 1px solid rgba(255,255,255,0.1);
            padding: 16px; z-index: 1000; box-sizing: border-box;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.5); backdrop-filter: blur(15px);
            overflow-y: auto; max-height: calc(100vh - 280px);
        }
        /* --- VIDEO BOX --- */
        #ui-video-box {
            position: absolute; top: 10px; left: 10px; width: 240px; height: 240px;
            border: 1px solid rgba(255,255,255,0.1); background: #000; overflow: hidden; z-index: 1000;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        #webcam-small { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        #face-dots-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: scaleX(-1); }
        /* --- UI ELEMENTS --- */
        .section { border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 12px; margin-bottom: 12px; }
        .section-title { font-size: 12px; color: #ffffff; font-weight: 500; letter-spacing: 0.5px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; cursor: move; }
        .control-group { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
        .control-group div { flex: 1; }
        label { display: block; font-size: 10px; color: #a0a0a0; margin-bottom: 4px; }
        .val-display { color: #00e5ff; float: right; }
        input[type=range] { width: 100%; accent-color: #651fff; cursor: pointer; }
        input[type=text], select { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #e0e0e0; padding: 8px; font-size: 12px; border-radius: 4px; }
        input[type=number] { width: 60px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #e0e0e0; padding: 4px; font-size: 12px; border-radius: 4px; }
        .btn { background: linear-gradient(135deg, #651fff, #311b92); color: white; border: none; padding: 8px 16px; width: 100%; font-weight: 500; cursor: pointer; font-size: 12px; margin-top: 4px; border-radius: 4px; transition: box-shadow 0.2s; box-shadow: 0 4px 15px rgba(101,31,255,0.4); }
        .btn:hover, .btn.fake-hover { box-shadow: 0 6px 20px rgba(101,31,255,0.6); }
        .btn-capture { background: linear-gradient(135deg, #00b8d4, #006064); box-shadow: 0 4px 15px rgba(0,184,212,0.4); }
        .btn-capture:hover, .btn-capture.fake-hover { box-shadow: 0 6px 20px rgba(0,184,212,0.6); }
        #timer-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 2000; text-align: center; pointer-events: none; display: none;
        }
        #timer-label { color: #00e5ff; font-size: 16px; letter-spacing: 1px; }
        #timer-count { color: #651fff; font-size: 64px; font-weight: bold; }
        #ui-text-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900; }
        .light-card { background: rgba(255,255,255,0.05); padding: 8px; border: 1px solid rgba(255,255,255,0.1); margin-top: 8px; border-radius: 4px; }
        #toggle-btns { position: absolute; bottom: 20px; left: 20px; z-index: 1001; display: flex; gap: 12px; }
        #white-cursor {
            position: absolute; width: 16px; height: 16px; background-color: white; border-radius: 50%; border: 2px solid #651fff;
            z-index: 9999; pointer-events: none; box-shadow: 0 0 8px rgba(255,255,255,0.5); will-change: transform;
        }
        .btn-small { width: 40px; padding: 8px 0; background: linear-gradient(135deg, #ff1744, #b71c1c); color: white; margin-left: 5px; border-radius: 4px; box-shadow: 0 4px 15px rgba(244,67,54,0.4); }
        .btn-small:hover, .btn-small.fake-hover { box-shadow: 0 6px 20px rgba(244,67,54,0.6); }
        .btn-inc { width: 28px; padding: 4px 0; background: rgba(255,255,255,0.05); color: #00b8d4; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }
        .btn-inc:hover, .btn-inc.fake-hover { background: rgba(255,255,255,0.1); }
        .slider-wrap { display: flex; align-items: center; gap: 4px; flex: 1; min-width: 160px; }
        .slider-wrap input[type=range] { flex: 1; }
        select option { background: #242424; color: #e0e0e0; }
        #cal-dot {
            position: absolute; width: 20px; height: 20px; background: red; border-radius: 50%; z-index: 2001; display: none;
            transform: translate(-50%, -50%);
        }
        #client-panel {
            display: none;
            position: absolute; top: 10px; right: 10px; width: 240px;
            background: linear-gradient(to bottom, rgba(20,20,30,0.95), rgba(5,5,10,0.95)); border: 1px solid rgba(255,255,255,0.1);
            padding: 16px; z-index: 1000; box-sizing: border-box;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.5); backdrop-filter: blur(15px);
        }
        #client-stats {
            margin-top: 10px;
            font-size: 12px;
            color: #00e5ff;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <canvas id="ui-text-canvas"></canvas>
    <div id="timer-overlay">
        <div id="timer-label">CENTER EYES</div>
        <div id="timer-count">3</div>
    </div>
    <div id="ui-video-box">
        <video id="webcam-small" autoplay muted playsinline></video>
        <canvas id="face-dots-overlay"></canvas>
    </div>
    <div id="tracker-panel">
        <div class="section-title">Neural Link Configuration</div>
        <button id="btn-calibrate" class="btn btn-capture">Init Calibration</button>
        <label>Input Source</label>
        <select id="input-source">
            <option value="local">Local Camera</option>
            <option value="remote">Remote Device</option>
        </select>
        <label>Input Mode</label>
        <select id="cursor-mode">
            <option value="iris">Iris Neural Link</option>
            <option value="head" selected>Head Pose Sync</option>
            <option value="hand">Hand Neural Link</option>
        </select>
        <label>Performance Mode</label>
        <select id="perf-mode-host">
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
        </select>
        <div style="display:flex; justify-content:space-between; margin-top:8px;">
            <label>Link Active</label>
            <input type="checkbox" id="tracking-toggle" checked>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:8px;">
            <label>Show Cursor</label>
            <input type="checkbox" id="show-cursor" checked>
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:8px;">
            <label>Mouse Tracking</label>
            <input type="checkbox" id="mouse-tracking">
        </div>
        <div style="display:flex; justify-content:space-between; margin-top:8px;">
            <label>Full Screen</label>
            <input type="checkbox" id="full-screen-host">
        </div>
        <label>H-Sensitivity <span id="h-val" class="val-display">100</span></label>
        <div class="slider-wrap">
            <input type="range" id="h-sens" min="1" max="1000" step="0.001" value="100">
            <input type="number" id="h-sens-num" step="0.001" value="100">
            <button class="btn-inc" id="h-sens-minus">-</button>
            <button class="btn-inc" id="h-sens-plus">+</button>
        </div>
        <label>V-Sensitivity <span id="v-val" class="val-display">100</span></label>
        <div class="slider-wrap">
            <input type="range" id="v-sens" min="1" max="1000" step="0.001" value="100">
            <input type="number" id="v-sens-num" step="0.001" value="100">
            <button class="btn-inc" id="v-sens-minus">-</button>
            <button class="btn-inc" id="v-sens-plus">+</button>
        </div>
        <label>Smoothing <span id="s-val" class="val-display">85%</span></label>
        <div class="slider-wrap">
            <input type="range" id="s-sens" min="0" max="98" step="0.001" value="85">
            <input type="number" id="s-sens-num" step="0.001" value="85">
            <button class="btn-inc" id="s-sens-minus">-</button>
            <button class="btn-inc" id="s-sens-plus">+</button>
        </div>
        <div class="section-title">Dead Zones</div>
        <label>Iris X <span id="dz-ix-val" class="val-display">0.010</span></label>
        <div class="slider-wrap">
            <input type="range" id="dz-ix" min="0.001" max="0.1" step="0.001" value="0.010">
            <input type="number" id="dz-ix-num" step="0.001" value="0.010">
            <button class="btn-inc" id="dz-ix-minus">-</button>
            <button class="btn-inc" id="dz-ix-plus">+</button>
        </div>
        <label>Iris Y <span id="dz-iy-val" class="val-display">0.010</span></label>
        <div class="slider-wrap">
            <input type="range" id="dz-iy" min="0.001" max="0.1" step="0.001" value="0.010">
            <input type="number" id="dz-iy-num" step="0.001" value="0.010">
            <button class="btn-inc" id="dz-iy-minus">-</button>
            <button class="btn-inc" id="dz-iy-plus">+</button>
        </div>
        <label>Head Yaw <span id="dz-head-yaw-val" class="val-display">1.0</span></label>
        <div class="slider-wrap">
            <input type="range" id="dz-head-yaw" min="0" max="10" step="0.1" value="1.0">
            <input type="number" id="dz-head-yaw-num" step="0.1" value="1.0">
            <button class="btn-inc" id="dz-head-yaw-minus">-</button>
            <button class="btn-inc" id="dz-head-yaw-plus">+</button>
        </div>
        <label>Head Pitch <span id="dz-hp-val" class="val-display">1.0</span></label>
        <div class="slider-wrap">
            <input type="range" id="dz-hp" min="0" max="10" step="0.1" value="1.0">
            <input type="number" id="dz-hp-num" step="0.1" value="1.0">
            <button class="btn-inc" id="dz-hp-minus">-</button>
            <button class="btn-inc" id="dz-hp-plus">+</button>
        </div>
        <label>Hand X <span id="dz-hx-val" class="val-display">0.010</span></label>
        <div class="slider-wrap">
            <input type="range" id="dz-hx" min="0.001" max="0.5" step="0.001" value="0.010">
            <input type="number" id="dz-hx-num" step="0.001" value="0.010">
            <button class="btn-inc" id="dz-hx-minus">-</button>
            <button class="btn-inc" id="dz-hx-plus">+</button>
        </div>
        <label>Hand Y <span id="dz-hand-y-val" class="val-display">0.010</span></label>
        <div class="slider-wrap">
            <input type="range" id="dz-hand-y" min="0.001" max="0.5" step="0.001" value="0.010">
            <input type="number" id="dz-hand-y-num" step="0.001" value="0.010">
            <button class="btn-inc" id="dz-hand-y-minus">-</button>
            <button class="btn-inc" id="dz-hand-y-plus">+</button>
        </div>
        <div class="section-title">Head Acceleration</div>
        <label>Head Slow X <span id="head-slow-x-val" class="val-display">0.100</span></label>
        <div class="slider-wrap">
            <input type="range" id="head-slow-x" min="0.001" max="10" step="0.001" value="0.1">
            <input type="number" id="head-slow-x-num" step="0.001" value="0.1">
            <button class="btn-inc" id="head-slow-x-minus">-</button>
            <button class="btn-inc" id="head-slow-x-plus">+</button>
        </div>
        <label>Head Fast X <span id="head-fast-x-val" class="val-display">1.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="head-fast-x" min="0.001" max="10" step="0.001" value="1">
            <input type="number" id="head-fast-x-num" step="0.001" value="1">
            <button class="btn-inc" id="head-fast-x-minus">-</button>
            <button class="btn-inc" id="head-fast-x-plus">+</button>
        </div>
        <label>Head Transition X <span id="head-trans-x-val" class="val-display">5.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="head-trans-x" min="0.001" max="10" step="0.001" value="5">
            <input type="number" id="head-trans-x-num" step="0.001" value="5">
            <button class="btn-inc" id="head-trans-x-minus">-</button>
            <button class="btn-inc" id="head-trans-x-plus">+</button>
        </div>
        <label>Head Slow Y <span id="head-slow-y-val" class="val-display">0.100</span></label>
        <div class="slider-wrap">
            <input type="range" id="head-slow-y" min="0.001" max="10" step="0.001" value="0.1">
            <input type="number" id="head-slow-y-num" step="0.001" value="0.1">
            <button class="btn-inc" id="head-slow-y-minus">-</button>
            <button class="btn-inc" id="head-slow-y-plus">+</button>
        </div>
        <label>Head Fast Y <span id="head-fast-y-val" class="val-display">1.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="head-fast-y" min="0.001" max="10" step="0.001" value="1">
            <input type="number" id="head-fast-y-num" step="0.001" value="1">
            <button class="btn-inc" id="head-fast-y-minus">-</button>
            <button class="btn-inc" id="head-fast-y-plus">+</button>
        </div>
        <label>Head Transition Y <span id="head-trans-y-val" class="val-display">5.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="head-trans-y" min="0.001" max="10" step="0.001" value="5">
            <input type="number" id="head-trans-y-num" step="0.001" value="5">
            <button class="btn-inc" id="head-trans-y-minus">-</button>
            <button class="btn-inc" id="head-trans-y-plus">+</button>
        </div>
        <div class="section-title">Hand Acceleration</div>
        <label>Hand Slow X <span id="hand-slow-x-val" class="val-display">1.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="hand-slow-x" min="0.001" max="10" step="0.001" value="1">
            <input type="number" id="hand-slow-x-num" step="0.001" value="1">
            <button class="btn-inc" id="hand-slow-x-minus">-</button>
            <button class="btn-inc" id="hand-slow-x-plus">+</button>
        </div>
        <label>Hand Fast X <span id="hand-fast-x-val" class="val-display">10.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="hand-fast-x" min="0.001" max="10" step="0.001" value="10">
            <input type="number" id="hand-fast-x-num" step="0.001" value="10">
            <button class="btn-inc" id="hand-fast-x-minus">-</button>
            <button class="btn-inc" id="hand-fast-x-plus">+</button>
        </div>
        <label>Hand Transition X <span id="hand-trans-x-val" class="val-display">0.001</span></label>
        <div class="slider-wrap">
            <input type="range" id="hand-trans-x" min="0.001" max="10" step="0.001" value="0.001">
            <input type="number" id="hand-trans-x-num" step="0.001" value="0.001">
            <button class="btn-inc" id="hand-trans-x-minus">-</button>
            <button class="btn-inc" id="hand-trans-x-plus">+</button>
        </div>
        <label>Hand Slow Y <span id="hand-slow-y-val" class="val-display">1.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="hand-slow-y" min="0.001" max="10" step="0.001" value="1">
            <input type="number" id="hand-slow-y-num" step="0.001" value="1">
            <button class="btn-inc" id="hand-slow-y-minus">-</button>
            <button class="btn-inc" id="hand-slow-y-plus">+</button>
        </div>
        <label>Hand Fast Y <span id="hand-fast-y-val" class="val-display">10.000</span></label>
        <div class="slider-wrap">
            <input type="range" id="hand-fast-y" min="0.001" max="10" step="0.001" value="10">
            <input type="number" id="hand-fast-y-num" step="0.001" value="10">
            <button class="btn-inc" id="hand-fast-y-minus">-</button>
            <button class="btn-inc" id="hand-fast-y-plus">+</button>
        </div>
        <label>Hand Transition Y <span id="hand-trans-y-val" class="val-display">0.001</span></label>
        <div class="slider-wrap">
            <input type="range" id="hand-trans-y" min="0.001" max="10" step="0.001" value="0.001">
            <input type="number" id="hand-trans-y-num" step="0.001" value="0.001">
            <button class="btn-inc" id="hand-trans-y-minus">-</button>
            <button class="btn-inc" id="hand-trans-y-plus">+</button>
        </div>
        <div class="section-title">Wink Detection</div>
        <label>Left Closed Thresh <span id="lct-val" class="val-display">0.180</span></label>
        <div class="slider-wrap">
            <input type="range" id="left-closed-thresh" min="0" max="1" step="0.001" value="0.180">
            <input type="number" id="left-closed-thresh-num" step="0.001" value="0.180">
            <button class="btn-inc" id="left-closed-thresh-minus">-</button>
            <button class="btn-inc" id="left-closed-thresh-plus">+</button>
        </div>
        <label>Left Open Thresh <span id="lot-val" class="val-display">0.250</span></label>
        <div class="slider-wrap">
            <input type="range" id="left-open-thresh" min="0" max="1" step="0.001" value="0.250">
            <input type="number" id="left-open-thresh-num" step="0.001" value="0.250">
            <button class="btn-inc" id="left-open-thresh-minus">-</button>
            <button class="btn-inc" id="left-open-thresh-plus">+</button>
        </div>
        <label>Right Closed Thresh <span id="rct-val" class="val-display">0.180</span></label>
        <div class="slider-wrap">
            <input type="range" id="right-closed-thresh" min="0" max="1" step="0.001" value="0.180">
            <input type="number" id="right-closed-thresh-num" step="0.001" value="0.180">
            <button class="btn-inc" id="right-closed-thresh-minus">-</button>
            <button class="btn-inc" id="right-closed-thresh-plus">+</button>
        </div>
        <label>Right Open Thresh <span id="rot-val" class="val-display">0.250</span></label>
        <div class="slider-wrap">
            <input type="range" id="right-open-thresh" min="0" max="1" step="0.001" value="0.250">
            <input type="number" id="right-open-thresh-num" step="0.001" value="0.250">
            <button class="btn-inc" id="right-open-thresh-minus">-</button>
            <button class="btn-inc" id="right-open-thresh-plus">+</button>
        </div>
        <div class="section-title">Pinch Detection</div>
        <label>Pinch Thresh <span id="pt-val" class="val-display">0.050</span></label>
        <div class="slider-wrap">
            <input type="range" id="pinch-thresh" min="0.01" max="0.2" step="0.001" value="0.050">
            <input type="number" id="pinch-thresh-num" step="0.001" value="0.050">
            <button class="btn-inc" id="pinch-thresh-minus">-</button>
            <button class="btn-inc" id="pinch-thresh-plus">+</button>
        </div>
        <button id="stop-connection" class="btn btn-small">Stop Connection</button>
    </div>
    <div id="client-panel">
        <div class="section-title">Remote Configuration</div>
        <label>Performance Mode</label>
        <select id="perf-mode-client">
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
        </select>
        <div style="display:flex; justify-content:space-between; margin-top:8px;">
            <label>Full Screen</label>
            <input type="checkbox" id="full-screen-client">
        </div>
        <div class="section-title">Data to Send</div>
        <div><input type="checkbox" id="send-iris" checked> Iris Gaze (eye data only)</div>
        <div><input type="checkbox" id="send-nose" checked> Nose Position (x,y)</div>
        <div><input type="checkbox" id="send-yaw-pitch" checked> Yaw and Pitch</div>
        <div><input type="checkbox" id="send-fingertips" checked> Index Tip and Thumb Tip</div>
        <div><input type="checkbox" id="send-full-face"> Full Face</div>
        <div><input type="checkbox" id="send-full-hand"> Full Hand</div>
        <div><input type="checkbox" id="send-all" checked> All</div>
        <div><input type="checkbox" id="send-none"> None</div>
        <div id="client-stats">FPS: <span id="fps-span">0</span> | Latency: <span id="lat-span">0</span>ms | Bat: <span id="bat-level">N/A</span>% | Bat Rate: <span id="bat-rate">0.00</span>%/min</div>
        <button id="stop-connection-client" class="btn btn-small">Stop Connection</button>
    </div>
    <div id="toggle-btns">
        <button class="btn btn-capture" id="toggle-tracker-ui" style="width:120px;">HUD UI</button>
    </div>
    <div id="white-cursor"></div>
    <div id="cal-dot"></div>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <script src="tracker.js"></script>
</body>
</html>